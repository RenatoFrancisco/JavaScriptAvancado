{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","NegociacaoDao","Negociacao","NegociacaoService","constructor","_http","obterNegociacoesDaSemana","Promise","resolve","reject","get","then","negociacoes","console","log","map","objeto","Date","data","quantidade","valor","catch","erro","obterNegociacoesDaSemanaAnterior","obterNegociacoesDaSemanaRetrasada","obterNegociacoes","all","periodos","reduce","dados","periodo","concat","dado","cadastra","negociacao","getConnection","connection","dao","adiciona","Error","lista","listaTodos","apaga","apagaTodos","importa","listaAtual","filter","some","negociacaoExistente","JSON","stringify"],"mappings":"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","file":"NegociacaoService.js","sourcesContent":["import {HttpService} from './HttpService';\r\nimport {ConnectionFactory} from './ConnectionFactory';\r\nimport {NegociacaoDao} from '../dao/NegociacaoDao';\r\nimport {Negociacao} from '../models/Negociacao';\r\n\r\nexport class NegociacaoService {\r\n    \r\n    constructor() {\r\n        \r\n        this._http = new HttpService();\r\n    }\r\n    \r\n    obterNegociacoesDaSemana() {\r\n       \r\n       return new Promise((resolve, reject) => {\r\n        \r\n            this._http\r\n                .get('negociacoes/semana')\r\n                .then(negociacoes => {\r\n                    console.log(negociacoes);\r\n                    resolve(negociacoes.map(objeto => new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor)));\r\n                })\r\n                .catch(erro => {\r\n                    console.log(erro);\r\n                    reject('Não foi possível obter as negociações da semana');\r\n                });  \r\n       });        \r\n    }\r\n    \r\n    obterNegociacoesDaSemanaAnterior() {\r\n       \r\n       return new Promise((resolve, reject) => {\r\n        \r\n            this._http\r\n                .get('negociacoes/anterior')\r\n                .then(negociacoes => {\r\n                    console.log(negociacoes);\r\n                    resolve(negociacoes.map(objeto => new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor)));\r\n                })\r\n                .catch(erro => {\r\n                    console.log(erro);\r\n                    reject('Não foi possível obter as negociações da semana anterior');\r\n                });  \r\n       }); \r\n       \r\n        \r\n    }\r\n    \r\n    obterNegociacoesDaSemanaRetrasada() {\r\n       \r\n       return new Promise((resolve, reject) => {\r\n        \r\n            this._http\r\n                .get('negociacoes/retrasada')\r\n                .then(negociacoes => {\r\n                    console.log(negociacoes);\r\n                    resolve(negociacoes.map(objeto => new Negociacao(new Date(objeto.data), objeto.quantidade, objeto.valor)));\r\n                })\r\n                .catch(erro => {\r\n                    console.log(erro);\r\n                    reject('Não foi possível obter as negociações da semana retrasada');\r\n                });  \r\n       }); \r\n    }    \r\n    \r\n    \r\n    obterNegociacoes() {\r\n\r\n        return new Promise((resolve, reject) => {\r\n\r\n            Promise.all([\r\n                this.obterNegociacoesDaSemana(),\r\n                this.obterNegociacoesDaSemanaAnterior(),\r\n                this.obterNegociacoesDaSemanaRetrasada()\r\n            ]).then(periodos => {\r\n\r\n                let negociacoes = periodos\r\n                    .reduce((dados, periodo) => dados.concat(periodo), [])\r\n                    .map(dado => new Negociacao(new Date(dado.data), dado.quantidade, dado.valor ));\r\n\r\n                resolve(negociacoes);\r\n\r\n            }).catch(erro => reject(erro));\r\n        });\r\n    }\r\n    \r\n    cadastra(negociacao) {\r\n\r\n        return ConnectionFactory\r\n            .getConnection()\r\n            .then(connection => new NegociacaoDao(connection))\r\n            .then(dao => dao.adiciona(negociacao))\r\n            .then(() => 'Negociacao cadastrada com sucesso')\r\n            .catch(erro => {\r\n                console.log(erro);\r\n                throw new Error('Não foi possível adicionar a negociação');        \r\n            });\r\n    }\r\n\r\n    lista() {\r\n\r\n        return ConnectionFactory\r\n            .getConnection()\r\n            .then(connection => new NegociacaoDao(connection))\r\n            .then(dao => dao.listaTodos())\r\n            .catch(erro => {\r\n                console.log(erro);\r\n                throw new Error('Não foi possível obter as negociações');\r\n            });\r\n    }\r\n\r\n    apaga() {\r\n\r\n        return ConnectionFactory\r\n            .getConnection()\r\n            .then(connection => new NegociacaoDao(connection))\r\n            .then(dao => dao.apagaTodos())\r\n            .then(() => 'Negociações apagadas com sucesso')\r\n            .catch(erro => {\r\n                console.log(erro);\r\n                throw new Error('Não foi possível apagar as negociações');\r\n            });\r\n    }\r\n\r\n    importa(listaAtual) {\r\n\r\n        return this.obterNegociacoes()\r\n            .then(negociacoes => \r\n                negociacoes.filter(negociacao => \r\n                    !listaAtual.some(negociacaoExistente =>\r\n                        JSON.stringify(negociacao) == JSON.stringify(negociacaoExistente)))\r\n            )\r\n            .catch(erro => {\r\n                console.log(erro);\r\n                throw new Error('Não foi possível importar as negociações');\r\n            });\r\n    }\r\n}\r\n\r\n"]}